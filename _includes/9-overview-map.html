<script>
if (L.Browser.android) {
  var drag = false;
  var basemap = L.Mapzen.BasemapStyles.BubbleWrap
}else{
  var drag = true;
  var basemap = L.Mapzen.BasemapStyles.WalkaboutNoLabels
  }

var map,
  tangramLayer,
  x = false,
  key = L.Mapzen.apiKey = "mapzen-btYeCLJ",
  labels = L.Mapzen.BasemapStyles.Walkabout;
function buildMap() {
  map = new L.Mapzen.map('map', {
    dragging: drag,
    scrollWheelZoom: false,
    zoomControl: false,
    tangramOptions: {
      scene: basemap
    }
  });
  /*why did I have to look through source code to find this??*/
  map.on('tangramloaded', function(e) {
    tangramLayer = e.tangramLayer;
  });
  var latlng = [39.098,-83.047];
  map.setView(latlng, 9);
  var geocoder = L.Mapzen.geocoder(key, {
    layers: ["locality", "street"]
  });
  /*geocoder.addTo(map);*/
  var newZoom = L.control.zoom();
  var explore = document.getElementById('explore');

  var roadTrails = new L.geoJson(null, {
    color: '#3c763d',
    weight: 8,
    opacity: 0.7,
  }).addTo(map);
  omnivore.geojson('https://www.ovrdc.org/apps/assets/data/bikeways/OVRDC_Bikeways.geojson', null, roadTrails);

  omnivore.geojson('https://www.ovrdc.org/apps/assets/data/bikeways/Gravel_Grinding_101_ridewithgps.geojson', null, roadTrails);

  omnivore.geojson('https://www.ovrdc.org/apps/assets/data/bikeways/Ridgetop_Ramble_ridewithgps.geojson', null, roadTrails);


  explore.addEventListener('click', function() {
    if (!map.isFullscreen()) {
      map.toggleFullscreen();
      x = true;
      if (!L.Browser.android) {tangramLayer.scene.load(L.Mapzen.BasemapStyles.Walkabout);}
      newZoom.addTo(map);
      geocoder.addTo(map);
      if (map.hasLayer(roadTrails)) {
        map.removeLayer(roadTrails);
        setTimeout(function() {
          map.addLayer(roadTrails)
        }, 200);
      }
      map.scrollWheelZoom.enable();
      map.dragging.enable();
    }
  });
  map.on('fullscreenchange', function () {
    if (!map.isFullscreen() && x == true) {
      map.invalidateSize();
      map.removeControl(newZoom);
      map.removeControl(geocoder);
      if (!L.Browser.android) {tangramLayer.scene.load(L.Mapzen.BasemapStyles.WalkaboutNoLabels);}
      map.scrollWheelZoom.disable();
      map.dragging.disable();
      x = false;
    }
  });
}
window.onload = function() {
  buildMap();
}
</script>
