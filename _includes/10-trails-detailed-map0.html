<script>
/*L.mapbox.accessToken = 'pk.eyJ1Ijoib3ZyZGMiLCJhIjoiRUtXeFFzZyJ9.ufnW36oCZo96m_L9QsAkYg';*/
var map = L.map('trailmap', {
  center: {{page.center}},
  zoom: {{page.zoom}},
  maxZoom: 20,
  scrollWheelZoom: false
});
var hills = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri &mdash; Source: Esri',
	maxNativeZoom: 13
});
var base = L.tileLayer('http://{s}.tile.openstreetmap.se/hydda/full/{z}/{x}/{y}.png', {
	maxNativeZoom: 18,
	attribution: 'Tiles courtesy of <a href="http://openstreetmap.se/" target="_blank">OpenStreetMap Sweden</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
  opacity: 0.8
});
var hillshade = new L.layerGroup([hills,base]).addTo(map);
var esri = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
  maxNativeZoom: 18,
  maxZoom: 20
});
var labels = L.tileLayer('https://{s}.tile.openstreetmap.se/hydda/roads_and_labels/{z}/{x}/{y}.png', {
	maxNativeZoom: 18,
  maxZoom: 20,
	attribution: 'Tiles courtesy of <a href="http://openstreetmap.se/" target="_blank">OpenStreetMap Sweden</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
});
var ortho = new L.layerGroup([esri, labels], {
});
/*var Parking = L.MakiMarkers.icon({icon: "parking", color: "#333", size: "m"});*/

var icons = {
  "Parking": "parking",
  "Camping": "campsite",
  "Park": "park",
  "POI": "circle-stroked",
  "Shelter": "shelter"
};

var redMarker = L.ExtraMarkers.icon({
  icon: 'parking',
  markerColor: 'black',
  shape: 'circle',
  prefix: 'maki',
  svg: true
});

L.marker([39, -83], {icon: redMarker,}).addTo(map);


var pois = new L.geoJson(null, {
  pointToLayer: function(feature, latlng) {
    return new L.marker(latlng, {icon:Parking})
  },
  onEachFeature: function(feature, layer) {
    var latlng = layer.feature._latlng.lat + ',' + layer.feature._latlng.lng;
    layer.bindPopup('<h4>Parking</h4><a href="https://www.google.com/maps/dir/' + latlng + '/" target="_blank">Directions</a>');
  }
}).addTo(map);

{% if page.csv %}
var poiscsv = new L.geoJson(null, {
  pointToLayer: function(feature, latlng) {
    var type = feature.properties.Type;
    console.log(type);
    return new L.marker(latlng, {icon: (L.ExtraMarkers.icon({
      icon: icons[type],
      markerColor: 'blue-dark',
      shape: 'circle',
      prefix: 'maki'
    }))
    })
  },
  onEachFeature: function(feature, layer) {
    console.log(layer.feature.properties.Type);
    var latlng = layer._latlng.lat + ',' + layer._latlng.lng;
    layer.bindPopup('<h4>Parking</h4><a href="https://www.google.com/maps/dir/?saddr=My+Location&daddr=' + latlng + '/" target="_blank">Directions</a>');
  }
}).addTo(map);

var poidata = omnivore.csv("{{site.baseurl}}/trails/data/{{page.csv}}");
poidata.on('ready', function() {
  console.log('csv data ready')
});
{% endif %}

{%for poi in page.pois %}
{% if poi.name %}
/*var parking = L.icon.mapkey({icon:"parking",color:'white',background:"black",size:24, boxShadow:false});*/
var {{poi.name}} = L.marker({{poi.latlng}});
latlng = {{poi.latlng | stringify}};
{{poi.name}}.bindPopup('<h4>Parking</h4><h5><a href="https://www.google.com/maps/dir/?saddr=My+Location&daddr=' + latlng + '" target="_blank">Directions</a></h5>');
pois.addLayer({{poi.name}});
{% endif %}
{% endfor%}

var trails = L.geoJson(null, {
  style: {
    color: '#1b7837',
    weight: 5,
    opacity: 1
  },
  filter: function(feature) {
    if (feature.properties.Status == "Existing") {
      return true
    }
  },
  onEachFeature: function (feature, trail) {
    trail.bindPopup(feature.properties.Name)
  }
}).addTo(map);

{% for layer in page.layers %}
$.getJSON("{{site.baseurl}}/trails/data/{{layer.file}}", function(data) {
  /*console.log(data);*/
  trails.addData(data)
});
{% endfor %}
/*map.on('zoomend', function() {
  if (map.getZoom() > 16) {
    map.removeLayer(hillshade);
    esri.addTo(map);
    labels.addTo(map);
  }
  if (map.getZoom() < 17) {
    if (map.hasLayer(esri)) {
      map.removeLayer(esri);
      map.removeLayer(labels);
      hillshade.addTo(map);
    }
  }
});*/
</script>
